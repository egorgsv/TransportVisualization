<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <title>Animate a point along a route</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css" rel="stylesheet" />
    <div id='map' style='width: 100%; height: 600px; margin:0; padding:0;'></div>
</head>
<body>
<style>
    .overlay {
        position: absolute;
        top: 20px;
        left: 20px;
    }

    .overlay button {
        font: 600 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        background-color: #3386c0;
        color: #fff;
        display: inline-block;
        margin: 0;
        padding: 10px 20px;
        border: none;
        cursor: pointer;
        border-radius: 3px;
    }

    .overlay button:hover {
        background-color: orange;
    }
</style>
<script
        src="https://api.tiles.mapbox.com/mapbox.js/plugins/turf/v2.0.0/turf.min.js"
        charset="utf-8"
></script>

<div id="map"></div>
<div class="overlay">
    <button id="replay">Replay</button>
</div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiZWdvcmdzdiIsImEiOiJjazdib2pjeTUwNXc5M2hwYTNicm9ibTN2In0.caVSPOdrlZjMzw_zXbnctg';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [30.0201721603789, 59.8548833060098],
        zoom: 10
    });

    var stringCoord = [];

    let stringCoord2 = '30.06205 59.8512444444444, 30.0620630946706 59.8512182865805, 30.0620046 59.8512109, 30.0618792 59.8511642, 30.0618128 59.8511116, 30.0617492 59.8510306, 30.0617598 59.8509453, 30.0617598 59.8509453, 30.0617702 59.8508611, 30.0618826 59.8507593, 30.061999 59.8507123, 30.0621377 59.8506886, 30.0623511 59.8506965, 30.0626281 59.8507059, 30.0628251 59.8507097, 30.0629433 59.8506903, 30.0630518 59.8506505, 30.0631449 59.8506058, 30.0631449 59.8506058, 30.0639091 59.8502317999999, 30.0645337 59.849975, 30.065079 59.8497725, 30.0657958 59.8495527, 30.0661608 59.849463, 30.0666574 59.8494139, 30.0668726197532 59.8494026993162, 30.06687 59.8493, 30.06205 59.8512444444444, 30.0620630946706 59.8512182865805, 30.0620046 59.8512109, 30.0618792 59.8511642, 30.0618128 59.8511116, 30.0617492 59.8510306, 30.0617598 59.8509453, 30.0617598 59.8509453, 30.0617702 59.8508611, 30.0618826 59.8507593, 30.061999 59.8507123, 30.0621377 59.8506886, 30.0623511 59.8506965, 30.0626281 59.8507059, 30.0628251 59.8507097, 30.0629433 59.8506903, 30.0630518 59.8506505, 30.0631449 59.8506058, 30.0631449 59.8506058, 30.0639091 59.8502317999999, 30.0645337 59.849975, 30.065079 59.8497725, 30.0657958 59.8495527, 30.0661608 59.849463, 30.0666574 59.8494139, 30.0668726197532 59.8494026993162, 30.06687 59.8493, 30.06687 59.84939, 30.0668726197532 59.8494026993162, 30.0668899 59.8494018, 30.0676394 59.8494041, 30.0699685 59.8494337, 30.0737654 59.8494953, 30.0756399 59.8495241, 30.0798225 59.8498138, 30.0834207 59.8500452, 30.084875 59.8501392, 30.0854351 59.8502017, 30.0861432 59.8503191, 30.0869557 59.8505, 30.0876962 59.8507147, 30.090017 59.8515907, 30.090199728437 59.8516620041819, 30.0918199999999 59.8522, 30.0918199999999 59.85226, 30.090199728437 59.8516620041819, 30.0910331 59.8519872, 30.0910928259273 59.8520099559166, 30.0928638 59.8526847, 30.0935408 59.8529461, 30.0941188 59.8531533, 30.0947655 59.8533806, 30.0954061 59.8535122, 30.0959719 59.8535676, 30.096478 59.8535869, 30.0971003 59.8535621, 30.0977933 59.8534977, 30.0993928 59.8533363, 30.1007544 59.8531831, 30.1011144 59.8531412, 30.1015073 59.8530913, 30.1016924738595 59.8530817082607, 30.1016916666667 59.853077777777, 30.1016916666667 59.8530777777778, 30.1016924738595 59.8530817082607, 30.1017158 59.8530805, 30.1019364 59.8531006, 30.1023374 59.8531861, 30.1025518 59.8532261, 30.1027646 59.8532526, 30.1029788 59.8532518, 30.1032355 59.853223, 30.1038891828715 59.8531540294082, 30.10925 59.8525884, 30.1101558 59.852499, 30.1111473 59.8523996, 30.1119967 59.8522911, 30.1127198 59.8521777, 30.1133763 59.8520342, 30.1160643000001 59.8513304, 30.1187832 59.8505719, 30.1187832 59.8505719, 30.1236202 59.8492505, 30.1242751 59.8490724, 30.1243624498348 59.8490486337994, 30.12431 59.84, 30.12431 59.849, 30.1243624498348 59.8490486337994, 30.1249929 59.8488771, 30.1252556 59.8488049, 30.1292691 59.847675, 30.1301236 59.847506, 30.1308071 59.847417, 30.1314214 59.8473839, 30.1327067699168 59.8473488698662, 30.132707 59.84735, 30.132707 59.847351, 30.1327067699168 59.8473488698662, 30.1351054 59.8472835, 30.1433538 59.84715, 30.1449715 59.8471223, 30.1449715 59.8471223, 30.1456432 59.8471096, 30.145721176329 59.8471083379294, 30.14572 59.8470, 30.14572 59.84709, 30.145721176329 59.8471083379294, 30.1458484083832 59.8471062786399, 30.146675 59.8470929, 30.1470097 59.8470888, 30.1471578 59.8470868, 30.1546889 59.8469006, 30.1567208 59.8468506, 30.1569118908426 59.8468472549812, 30.156911 59.8468, 30.156911 59.84682, 30.1569118908426 59.8468472549812, 30.1570807 59.8468443, 30.1581219136441 59.8468261896984, 30.1582938 59.8468232, 30.1582938 59.8468232, 30.1591744 59.8468094, 30.1591744 59.8468094, 30.1636653 59.8467275, 30.1662106 59.846636, 30.1714669 59.8465513, 30.1719127364417 59.8465473186066, 30.17191 59.8464, 30.17191 59.84647, 30.1719127364417 59.8465473186066, 30.1720268 59.8465463, 30.1730234093129 59.8465402574551, 30.1737256 59.846536, 30.1750154 59.8465088, 30.1788165509248 59.846424795038, 30.17881 59.8463, 30.17881 59.84635, 30.1788165509248 59.846424795038, 30.1788842 59.8464233, 30.1790659749192 59.8464192264255, 30.1791564 59.8464172, 30.1802549 59.8463928, 30.1836445 59.8463301, 30.1874449312645 59.8462467026914, 30.18744 59.8461, 30.18744 59.84619, 30.187436600324 59.8462579655297, 30.1949112 59.8460888, 30.196365716468 59.846058621281, 30.1963611111111 59.8460, 30.1963611111111 59.84605, 30.1963608753848 59.8460471300439, 30.1963961 59.8460464, 30.1965572 59.8460427, 30.1966807 59.8460398, 30.1966807 59.8460398, 30.1976127 59.8460182, 30.1976127 59.8460182, 30.1978178 59.846013, 30.1983362 59.8459999, 30.2040439081738 59.8458875687214, 30.2040444444444 59.845894444444, 30.2040444444444 59.8458944444444, 30.2040439081738 59.8458875687214, 30.2040474 59.8458875, 30.2043242 59.845882, 30.2108226673692 59.8457542337936, 30.21082 59.8457, 30.21082 59.84572, 30.2108226673692 59.8457542337936, 30.2109668 59.8457514, 30.2112553 59.845746, 30.2120535 59.8457312, 30.2120535 59.8457312, 30.2123038 59.8457347, 30.2127858 59.8457595, 30.2135963 59.8458048, 30.2144697 59.8458953, 30.2153384 59.8459879, 30.2164229 59.8461243, 30.2173603 59.8462473, 30.2181612 59.8463923, 30.2189971 59.8465635, 30.2201504 59.8468431, 30.2201504 59.8468431, 30.2207855 59.8469958, 30.2208515895016 59.8470114809028, 30.2209 59.8469, 30.2209 59.84696, 30.2208515895016 59.8470114809028, 30.2211134 59.8470736, 30.2233042 59.8475798, 30.2255518 59.8480119, 30.2263533 59.84817, 30.2272941 59.8483975, 30.2273769 59.8484184, 30.2273817756607 59.8484195960814, 30.22743 59.8483, 30.22743 59.84837, 30.2273817756607 59.8484195960814, 30.227489 59.8484459, 30.2277875 59.848526, 30.2281134 59.8486252, 30.2294351 59.8490372, 30.2306165 59.8494174, 30.2321545 59.8499738, 30.2335118 59.8505006, 30.2347097 59.851002, 30.2350340735675 59.8511358493037, 30.23506 59.8511, 30.23506 59.85112, 30.2350340735675 59.8511358493037, 30.2381028 59.8524021, 30.2390327 59.8527651, 30.2412269 59.8535843, 30.2423718 59.8540149, 30.2425939 59.854097, 30.2426976582038 59.8541352750824, 30.24272 59.8541, 30.24272 59.85412, 30.2426976582038 59.8541352750824, 30.2428311 59.8541845, 30.2438428 59.8545660999999, 30.2470071 59.8559271, 30.2483891 59.8565215, 30.2530282 59.858712, 30.2532262568598 59.8588161751608, 30.25312 59.8587, 30.25312 59.85876, 30.2532262568598 59.8588161751608, 30.2539615 59.8592029, 30.2539615 59.8592029, 30.2548133 59.8596696, 30.2555925 59.860083, 30.2559526 59.8602908, 30.2562301 59.8604393, 30.2563948 59.8605398, 30.256563 59.8606646, 30.2569527 59.861052, 30.2574305 59.8616638, 30.2575882 59.8620162, 30.2576696 59.862322, 30.2579582 59.8643291, 30.2579991 59.8647465, 30.2579724 59.8650417, 30.2578721 59.8655165, 30.2578721 59.8655165, 30.257079 59.8683667, 30.2569657186222 59.8687350180349, 30.25703 59.8687, 30.25703 59.86874, 30.2569650825786 59.8687349808656, 30.2566835 59.8696527, 30.2566300676249 59.8698014822769, 30.2565842 59.8699292, 30.2561644432975 59.8712816389371, 30.2561861111111 59.871283333333, 30.2561861111111 59.8712833333333, 30.2561776804691 59.8712826730025, 30.2560716 59.8716239, 30.2559713 59.8719572, 30.2558208 59.8721423, 30.2551644 59.8726741, 30.2551604822629 59.8726776815084, 30.2550339 59.8727934, 30.2549632 59.8729067, 30.2544311 59.8746138, 30.2543681 59.8748235, 30.2543285 59.875102, 30.2543158 59.8753811, 30.2543657288304 59.8760004927967, 30.25439 59.87, 30.25439 59.876, 30.2543657288304 59.8760004927967, 30.2543666 59.8760113, 30.2543783 59.876106, 30.2543783 59.876106, 30.2543906909662 59.8762613496527, 30.2543984 59.876358, 30.2544026 59.876429, 30.2544026 59.876429, 30.2544051 59.8764731, 30.2544256 59.8766977, 30.2544324 59.8767622, 30.2545041 59.8774546, 30.2545356 59.8775682, 30.2545902 59.8776659, 30.2546817 59.8777473, 30.2548157 59.8778232, 30.2554487 59.8780365, 30.2555583 59.8780637, 30.2556765 59.8780814, 30.2557801 59.8780816, 30.2559018 59.87807, 30.2572822251454 59.877746445351, 30.2572777777778 59.877741666666, 30.2572777777778 59.8777416666667, 30.2572822251454 59.877746445351, 30.2577408713508 59.8776389436334, 30.2583247 59.8775021, 30.2590003 59.8773331, 30.2596363 59.877158, 30.2637894 59.8759517, 30.2638915 59.8759231, 30.2638918952496 59.8759230187168, 30.263878 59.87590, 30.263878 59.875906, 30.2638918952496 59.8759230187168, 30.2640437 59.8758918, 30.2641659 59.8758797, 30.2641883654727 59.8758808923017, 30.2642733 59.8758854, 30.2643665 59.875907, 30.2644745 59.8759425, 30.2645717 59.8760096, 30.266681703426 59.8781197906541, 30.2668 59.8780, 30.2668 59.87809, 30.266681703426 59.8781197906541, 30.2667882509086 59.8782263440384, 30.2669209 59.878359, 30.2702998332857 59.8817501136646, 30.27038 59.8817, 30.27038 59.88173, 30.2702998332857 59.8817501136646, 30.2703335 59.8817839, 30.2704104724936 59.881861494963, 30.2739938 59.8854736, 30.2740696728588 59.885550072093, 30.27411 59.8855, 30.27411 59.88554, 30.2740589814137 59.8855506268709, 30.2754563558152 59.8869554126542, 30.2768751878907 59.8883709040776, 30.27691 59.8883, 30.27691 59.88836, 30.2768766766355 59.8883684019546, 30.2771737 59.8886649, 30.2772664 59.8887618, 30.2773102 59.8888611, 30.2773089459301 59.8888671093938, 30.2772929 59.888944, 30.2771331 59.8890436, 30.2770464 59.8890858, 30.2731238 59.890089, 30.2726181276089 59.890218316573, 30.27263 59.8902, 30.27263 59.89023, 30.2726181134887 59.8902183027881, 30.2724239505286 59.8902679567911, 30.2654249 59.8920578, 30.2653705 59.8920704, 30.2653142 59.8920807, 30.2652566 59.8920888, 30.2651978 59.8920945, 30.2651382 59.8920978, 30.2650784 59.8920987, 30.2650186 59.8920972, 30.2624853 59.8919834, 30.2624214338147 59.8919805293718, 30.2624194444444 59.891991666666, 30.2624194444444 59.8919916666667, 30.2624214338147 59.8919805293718, 30.2575529 59.8917617, 30.2574459 59.8917594, 30.2573389 59.8917622, 30.257233 59.8917701, 30.257129 59.891783, 30.2570279 59.8918008, 30.2569306 59.8918233, 30.256838 59.8918503, 30.2567509 59.8918815, 30.2566451 59.8919234, 30.2566451 59.8919234, 30.2565452 59.8919993, 30.2565276 59.8920449, 30.2565326 59.8920942, 30.2565629 59.8921384, 30.2566184 59.8921802, 30.2566965 59.8922194, 30.2568049 59.8922422, 30.2569461 59.8922497, 30.2570595 59.892254, 30.2570595 59.892254, 30.2571806 59.8922586, 30.2573193 59.8922776, 30.257458 59.892313, 30.2574836210469 59.8923254608616, 30.2575386 59.8923522, 30.2575916 59.8923927, 30.2576143 59.8924344, 30.2576244 59.892485, 30.2576168 59.8925331, 30.2575336 59.8927354, 30.2575054 59.8927739, 30.2574891719644 59.8927863148961, 30.2575138888889 59.892794444444';

    stringCoord.push('29.82678 59.88141, 29.8269290005498 59.8813721552216, 29.8262225349271 59.8805761469035, 29.8259658616483 59.8802965798163, 29.8255160693044 59.8797747356195, 29.8247770835399 59.8789244681838, 29.8244039379753 59.8785030978724, 29.8240415212476 59.878103258922, 29.8284857330894 59.8771279125224, 29.8297732 59.8768437, 29.8297732 59.8768437, 29.8308483371679 59.8766058579935, 29.830741375 59.876484077777, 29.82678 59.88141, 29.8269290005498 59.8813721552216, 29.8262225349271 59.8805761469035, 29.8259658616483 59.8802965798163, 29.8255160693044 59.8797747356195, 29.8247770835399 59.8789244681838, 29.8244039379753 59.8785030978724, 29.8240415212476 59.878103258922, 29.8284857330894 59.8771279125224, 29.8297732 59.8768437, 29.8297732 59.8768437, 29.8308483371679 59.8766058579935, 29.830741375 59.876484077777, 29.830741375 59.8764840777778, 29.8308483371679 59.8766058579935, 29.8313594 59.8764928, 29.8313594 59.8764928, 29.8331674 59.876082, 29.8363194 59.8753894, 29.8364531 59.8753555, 29.8378055 59.8750465, 29.8378055 59.8750465, 29.8382508494731 59.874947604251, 29.8381428694444 59.874825119444, 29.8381428694444 59.8748251194444, 29.8382508494731 59.874947604251, 29.8392096 59.8747347, 29.8392096 59.8747347, 29.8415410846522 59.8742371164134, 29.8432631111518 59.8738022220588, 29.8440785509293 59.8736257981746, 29.8497786 59.8723216, 29.8521543067445 59.8717904296091, 29.8523370220924 59.8719014, 29.8527785721461 59.8722269902698, 29.8529939827545 59.8723924767586, 29.8532308510368 59.8725498848149, 29.8533622194445 59.872501072222, 29.8533622194445 59.8725010722222, 29.8532308510368 59.8725498848149, 29.8543595779077 59.8733315473188, 29.8560345784269 59.874468392982, 29.856111 59.87444, 29.856111 59.874444, 29.8560453072639 59.874468392982, 29.856762371163 59.874996546814, 29.8598944 59.8771151, 29.8610445 59.8779156, 29.8615146 59.8782428, 29.861976671163 59.8785771840975, 29.8622204509293 59.878782139843, 29.8625134153477 59.8789706197742, 29.8627174365108 59.8790563700172, 29.8628785423261 59.8791178920048, 29.863180278837 59.8791587860259, 29.8634391 59.8791754520045, 29.8637539220924 59.8791272860821, 29.8640741086032 59.8790414319579, 29.8642569 59.8789391, 29.8645817322279 59.8786117360338, 29.8643658027778 59.878557777777, 29.8643658027778 59.8785577777778, 29.8645817322279 59.8786117360338, 29.8647443 59.8784479, 29.8654985 59.8775589, 29.8663286490707 59.8766602986676, 29.867962 59.877408, 29.867962 59.877408, 29.8682922403399 59.8775569871222, 29.868543 59.87741, 29.868543 59.877417, 29.8682922403399 59.8775569871222, 29.8689406644184 59.877839023676, 29.8724784529217 59.8794177370182, 29.8737833249754 59.8799647922006, 29.875905611664 59.8808345700243, 29.8771320404675 59.8813382389119, 29.8794051900556 59.8822351921294, 29.8804130188063 59.8826217501358, 29.8809437552741 59.8828338693852, 29.8813993898832 59.8830190704035, 29.8834821026155 59.883878295614, 29.8855540865109 59.8847428817103, 29.8895241 59.8828648, 29.8895241 59.8828648, 29.8902430994176 59.8827617765759, 29.8901871138889 59.882663402777, 29.8901871138889 59.8826634027778, 29.8902430994176 59.8827617765759, 29.8908522 59.8826745, 29.8908522 59.8826745, 29.8953184 59.8820345, 29.8953184 59.8820345, 29.8958520482779 59.88195351466, 29.8957907138889 59.881851752777, 29.8957907138889 59.8818517527778, 29.8958520482779 59.88195351466, 29.899701 59.8813694, 29.899701 59.8813694, 29.9034327 59.880834, 29.9034327 59.880834, 29.9041871085954 59.8807219436875, 29.9041384027778 59.88063937, 29.9041384027778 59.880639375, 29.9041871085954 59.8807219436875, 29.9062879 59.8804099, 29.9062879 59.8804099, 29.9068373 59.8803376, 29.9092547 59.880009, 29.9092547 59.880009, 29.9105173981251 59.879820352081, 29.9104391027778 59.879688383333, 29.9104391027778 59.8796883833333, 29.9105173981251 59.879820352081, 29.911918 59.8796111, 29.911918 59.8796111, 29.9133189 59.8794093, 29.9136283 59.8793629759558, 29.9144435997606 59.8792442761706, 29.9174672698886 59.8788056430637, 29.9174163277778 59.878712447222, 29.9174163277778 59.8787124472222, 29.9174672698886 59.8788056430637, 29.9193992 59.8785397, 29.9193992 59.8785397, 29.9205219 59.8783781, 29.923205 59.8779919, 29.923205 59.8779919, 29.9241288086494 59.8778618513883, 29.924092 59.87779, 29.924092 59.877796, 29.9241288086494 59.8778618513883, 29.9259974 59.8775988, 29.9259974 59.8775988, 29.9280211499644 59.877310246791, 29.927963375 59.877208194444, 29.927963375 59.8772081944444, 29.9280211499644 59.877310246791, 29.9283469 59.8772638, 29.9284641 59.8772471, 29.9284641 59.8772471, 29.9294935 59.8771082, 29.9378619 59.8758805, 29.9458225 59.8747264, 29.9460381 59.8746936, 29.9460381 59.8746936, 29.9467406870969 59.8745902759497, 29.9466769888888 59.874481169444, 29.9466769888888 59.8744811694444, 29.9467406870969 59.8745902759497, 29.9482766 59.8743644, 29.9482766 59.8743644, 29.9504771 59.8740461, 29.9504771 59.8740461, 29.9517631751561 59.8738560877963, 29.9516968111111 59.873742936111, 29.9516968111111 59.8737429361111, 29.9517631751561 59.8738560877963, 29.9531127 59.8736567, 29.9531127 59.8736567, 29.959580974985 59.8727202582321, 29.9595085055555 59.872594141666, 29.9595085055555 59.8725941416667, 29.9595756105666 59.8727229507548, 29.9619999711631 59.8723761553082, 29.9680120711631 59.8714913041092, 29.9686972509293 59.8713420116292, 29.9690599408124 59.8711913781812, 29.9699122400876 59.8708400172044, 29.9697378027778 59.870728102777, 29.9697378027778 59.8707281027778, 29.9699068756692 59.8708400172044, 29.9703481402495 59.8706565940076, 29.9715833387639 59.8701285017961, 29.9731847 59.8694062, 29.9741427 59.868995, 29.9769677509294 59.8677710858477, 29.9774050899349 59.8675873196637, 29.9772369 59.867486458333, 29.9772369 59.8674864583333, 29.9774099377077 59.8675847256296, 29.9803081 59.8663365, 29.9836784 59.8648727, 29.9847021929765 59.8644308466925, 29.9845458138889 59.864339105555, 29.9845458138889 59.8643391055556, 29.9847025650901 59.8644306407445, 29.9874721 59.8632352, 29.991946 59.8612837, 29.991946 59.8612837, 29.9928526960453 59.8608854181432, 29.9926411805555 59.86076402, 29.9926411805555 59.860764025, 29.9928526960453 59.8608854181432, 29.994113 59.8603318, 29.9948535 59.8601195, 29.9995732 59.8591678, 30.0046464 59.858117, 30.0058398 59.8578698, 30.0058398 59.8578698, 30.0073283 59.8575483, 30.0073283 59.8575483, 30.0081074036496 59.8573872061741, 30.0080156527778 59.857275313888, 30.0080156527778 59.8572753138889, 30.0081074036496 59.8573872061741, 30.0115644 59.8566724, 30.0115644 59.8566724, 30.0121367260209 59.8565553420702, 30.0120511638889 59.8564498, 30.0120511638889 59.85644985, 30.0121367260209 59.8565553420702, 30.016678 59.8556265, 30.016678 59.8556265, 30.0190451220924 59.8551233697412, 30.0201721603789 59.8548833060098, 30.0200986555555 59.854784077777, 30.0200986555555 59.8547840777778, 30.0201721603789 59.8548833060098, 30.021341 59.8546375, 30.021341 59.8546375, 30.0222252 59.8544608, 30.0226706 59.8543759, 30.025792 59.8540097, 30.025792 59.8540097, 30.0266539804745 59.8539098648869, 30.0265915694445 59.853773958333, 30.0265915694445 59.8537739583333, 30.0266539804745 59.8539098648869, 30.0287267 59.8536698, 30.0287267 59.8536698, 30.031144 59.8533924, 30.0366036 59.8527921, 30.037338 59.8527011, 30.037338 59.8527011, 30.0380332223632 59.8526189191263, 30.0379677222223 59.852479155555, 30.0379677222223 59.8524791555555, 30.0380332223632 59.8526189191263, 30.0385122 59.8525623, 30.0385122 59.8525623, 30.0397137 59.8524295, 30.0405818 59.852352, 30.0425772 59.8522797, 30.0429322 59.8522416, 30.0431909 59.8521991, 30.0434148 59.8521367, 30.0436259 59.8520465, 30.0443638 59.8515885, 30.0448122 59.851407, 30.0452687 59.8513381, 30.0458409 59.8513029, 30.0484717 59.8513228, 30.0484717 59.8513228, 30.0492826864109 59.8513362284737, 30.0492911888889 59.851206, 30.0492911888889 59.8512067, 30.0492826864109 59.8513362284737, 30.0505613 59.8513574, 30.0505613 59.8513574, 30.0542185 59.8514179, 30.0542185 59.8514179, 30.0548281284773 59.8514279413204, 30.0548364083334 59.851301138888, 30.0548364083334 59.8513011388889, 30.0548281284773 59.8514279413204, 30.0625482 59.8515551, 30.0666921 59.8516328, 30.0666921 59.8516328, 30.0634230384662 59.8515715036322, 30.0634314194445 59.851458755555, 30.0634314194445 59.8514587555555, 30.0634230384662 59.8515715036322, 30.0666921 59.8516328, 30.0666921 59.8516328, 30.070782934772 59.8516964845324, 30.070790175 59.851579169444, 30.070790175 59.8515791694445, 30.0707826460416 59.851694786669, 30.0728350537771 59.851737659582, 30.0747158001214 59.8517643671259, 30.074719 59.85168, 30.074719 59.851686, 30.0747132558622 59.8517652089458, 30.0809201139196 59.8518787473776, 30.0809290444445 59.851755, 30.0809290444445 59.8517556, 30.0809201139196 59.8518787473776, 30.0834377 59.8519248, 30.0834377 59.8519248, 30.0856109 59.8519646, 30.0865379 59.8520508, 30.0905719 59.8528397, 30.0906051 59.8521219, 30.0906302 59.8515789, 30.0906552 59.8510369, 30.0906552 59.8510369, 30.0906704547092 59.8507069433536, 30.0904330833333 59.85070417, 30.0904330833333 59.850704175, 30.0906704547092 59.8507069433536, 30.0908081441847 59.8488836110947, 30.091012 59.8453536, 30.0912266 59.8421845, 30.091292 59.8413248, 30.091292 59.8413248, 30.0913376 59.840401, 30.0915279 59.8358914, 30.0916542134892 59.8340365087991, 30.0915848779076 59.8339286073111, 30.0914833558152 59.8337802703647, 30.0914651956106 59.8337108012072, 30.0915221372646 59.8336089836476, 30.0913380818617 59.8336370042617, 30.0911111111112 59.833611111111');

    stringCoord.push('30.12631944 59.83640278, 30.1264512218176 59.8364022177046, 30.1264348 59.8354305, 30.1272558 59.8354335, 30.1272558 59.8354335, 30.1281837212332 59.8354254608498, 30.12818056 59.8353333, 30.12631944 59.83640278, 30.1264512218176 59.8364022177046, 30.1264348 59.8354305, 30.1272558 59.8354335, 30.1272558 59.8354335, 30.1281837212332 59.8354254608498, 30.12818056 59.8353333, 30.12818056 59.83533333, 30.1281837212332 59.8354254608498, 30.12826 59.8354248, 30.12826 59.8354248, 30.1344589723862 59.8354058564192, 30.13445833 59.8353527, 30.13445833 59.83535278, 30.1344589723862 59.8354058564192, 30.1390587 59.8353918, 30.1390587 59.8353918, 30.1401744 59.8354004, 30.1401744 59.8354004, 30.141258565708 59.8353996583484, 30.1412583333333 59.835313888888, 30.1412583333333 59.8353138888889, 30.141258565708 59.8353996583484, 30.1435366 59.8353981, 30.1435366 59.8353981, 30.1466694 59.8354089, 30.1466694 59.8354089, 30.1479361111111 59.8354089, 30.1479361111111 59.835313888888, 30.1479361111111 59.8353138888889, 30.1479361111111 59.8354089, 30.1485362 59.8354089, 30.1499739 59.835355, 30.151735 59.835257, 30.1563937 59.8345424, 30.1563937 59.8345424, 30.1574119388354 59.8343778624566, 30.1573638888889 59.834302777777, 30.1573638888889 59.8343027777778, 30.1574119388354 59.8343778624566, 30.1599731 59.833964, 30.1599731 59.833964, 30.1611191 59.8337958, 30.1651874 59.8331985, 30.1651874 59.8331985, 30.1659266759676 59.8331280496437, 30.1658972222222 59.8330, 30.1658972222222 59.83305, 30.1659266759676 59.8331280496437, 30.1666544 59.8330587, 30.1666544 59.8330587, 30.1738802 59.8330714, 30.1756569 59.8330282, 30.1756569 59.8330282, 30.1770397711816 59.8330240385304, 30.1770388888889 59.8329, 30.1770388888889 59.83295, 30.1770397711816 59.8330240385304, 30.1823362 59.8330081, 30.1823362 59.8330081, 30.1830962340302 59.8330122599126, 30.1830972222222 59.832966666666, 30.1830972222222 59.8329666666667, 30.1830962340302 59.8330122599126, 30.1844373 59.8330196, 30.1844373 59.8330196, 30.194494 59.8329817, 30.194494 59.8329817, 30.1965945511989 59.8330083706449, 30.1966 59.832, 30.1966 59.8329, 30.1965945511989 59.8330083706449, 30.1971403 59.8330153, 30.1971403 59.8330153, 30.1994767 59.8330583, 30.2042976 59.8331214, 30.2042976 59.8331214, 30.205196060135 59.8331424550989, 30.2052 59.833099999999, 30.2052 59.8330999999999, 30.205196060135 59.8331424550989, 30.2102418 59.8332607, 30.2102418 59.8332607, 30.2133930881727 59.8333104836092, 30.2134 59.833, 30.2134 59.8332, 30.2133930881727 59.8333104836092, 30.2150779 59.8333371, 30.216949 59.8334751, 30.2180734 59.8336519, 30.2180734 59.8336519, 30.2190237833714 59.8338801395646, 30.2191 59.833, 30.2191 59.8338, 30.2190237833714 59.8338801395646, 30.2191044 59.8338995, 30.2227683 59.8349113, 30.2227683 59.8349113, 30.223699373419 59.8351937538242, 30.2238 59.8351, 30.223699373419 59.8351937538242, 30.2306304 59.8372963, 30.2323377950403 59.837904519327, 30.23245 59.837825, 30.2323377950403 59.8379045193277, 30.2384504 59.8400819, 30.2384504 59.8400819, 30.2389702561468 59.8402821396549, 30.2390277777778 59.840244444444, 30.2390277777778 59.8402444444444, 30.2389702561468 59.8402821396549, 30.2394964 59.8404848, 30.2394964 59.8404848, 30.2423222 59.8415227, 30.2442697 59.842238, 30.2481324 59.8439093, 30.248891784624 59.8442386693298, 30.2503872759784 59.8442201048076, 30.2504419659179 59.8449349757251, 30.2488980591522 59.8449653667224, 30.2488883760701 59.8442519935141, 30.2453233433935 59.8427139905138, 30.2452 59.842');


    var json1 = {"tracks": [{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":19.35,"TIME_STAGE":null,"TIME_STAGE_PLAN":3.1,"DISTANCE_BACK":0.83,"DISTANCE_BACK_NORM":1,"STOP_TIME_PLAN":"01.09.2019 11:14:34","STOP_NAME":"ЖЕЛЕЗНОДОРОЖНЫЙ ПЕРЕЕЗД","LATITUDE":59.91333244,"LONGITUDE":29.7822113,"STOP_NUMBER":3,"ID_STOP":20108,"STAGE_SHAPE":"29.78221 59.91333, 29.782433297459 59.9134904498913, 29.7825358 59.9134546, 29.7825358 59.9134546, 29.7828141 59.9133668, 29.7829566 59.9133203, 29.7832227 59.9132352, 29.7834836 59.9131543, 29.7836338 59.9131019, 29.7842496 59.9129236, 29.784763 59.9127976, 29.7858383 59.9126107, 29.7866831 59.9124045, 29.7879116 59.9120536, 29.7889225 59.9117665, 29.7891665 59.9116972, 29.7904638 59.911432, 29.791309 59.9112582, 29.7920856 59.9111701, 29.7928595 59.9110812, 29.7934477 59.9110282, 29.7936073 59.9110126, 29.7938287 59.910989, 29.7938287 59.910989, 29.7939591 59.9109772, 29.794312 59.9109705, 29.7946722 59.9109559, 29.7948190814829 59.9109373734954, 29.7951027 59.9109016, 29.7951027 59.9109016, 29.7952808 59.9108617, 29.7953591393637 59.9108507834381, 29.79527 59.9106"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":23.99,"TIME_STAGE":null,"TIME_STAGE_PLAN":1,"DISTANCE_BACK":0.57,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 11:15:34","STOP_NAME":"МОРСКАЯ УЛ. 35 [200]<","LATITUDE":59.91069583,"LONGITUDE":29.795269,"STOP_NUMBER":4,"ID_STOP":2885,"STAGE_SHAPE":"29.79527 59.91069, 29.7953591393637 59.9108507834381, 29.7955822 59.9108197, 29.7963597 59.9106528, 29.7972116 59.9104297, 29.7981013 59.9101647, 29.7981013 59.9101647, 29.7988851 59.9099489, 29.8004593 59.9096734999999, 29.8017496 59.9095195, 29.8024832 59.9094175, 29.8024832 59.9094175, 29.8036127429857 59.9092284563957, 29.804229960096 59.9091251566875, 29.80412 59.9089"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":23.99,"TIME_STAGE":null,"TIME_STAGE_PLAN":1,"DISTANCE_BACK":0.43,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 11:16:34","STOP_NAME":"ЛЕСНАЯ УЛ.","LATITUDE":59.90896308,"LONGITUDE":29.804121,"STOP_NUMBER":5,"ID_STOP":2861,"STAGE_SHAPE":"29.80412 59.90896, 29.804229960096 59.9091251566875, 29.8055914 59.9088973, 29.8055914 59.9088973, 29.8066047 59.9087334, 29.8071849 59.9086951, 29.8071849 59.9086951, 29.8075896 59.9086431, 29.8080989 59.9085759, 29.8089176 59.9084214, 29.8097801 59.9082209, 29.8100392432267 59.9081492720352, 29.8104107 59.9080466, 29.8104107 59.9080466, 29.8107384862564 59.9079290172723, 29.81059 59.9077"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":35.99,"TIME_STAGE":null,"TIME_STAGE_PLAN":1,"DISTANCE_BACK":0.86,"DISTANCE_BACK_NORM":0.6,"STOP_TIME_PLAN":"01.09.2019 11:17:34","STOP_NAME":"УЛ. ЖОРЫ АНТОНЕНКО","LATITUDE":59.90778161,"LONGITUDE":29.8105907,"STOP_NUMBER":6,"ID_STOP":20118,"STAGE_SHAPE":"29.81059 59.90778, 29.8107921304411 59.9079397759553, 29.811072 59.9078518, 29.8115161 59.9076948, 29.8126133 59.9072112, 29.8129844 59.9069974, 29.8130574 59.9069442, 29.8133259000001 59.9066261, 29.8137096 59.9060086, 29.8137924 59.9058633, 29.8137924 59.9058633, 29.8138368 59.9057041, 29.813828 59.9055616, 29.8135996 59.9048085, 29.8135942 59.9044961, 29.8136133823112 59.9043545203043, 29.8136462 59.9041123, 29.8136853 59.9039539, 29.8137655 59.9038334, 29.8138834 59.9037545, 29.8140714 59.9036479, 29.8144397 59.9035079, 29.8148721 59.9033772, 29.8149978 59.9033293, 29.8149978 59.9033293, 29.8150601 59.9033098, 29.8159065 59.9030624, 29.8164678 59.9028794, 29.8167615 59.902744, 29.8171997 59.9025408, 29.8175364 59.9023371, 29.8175364 59.9023371, 29.8178177520702 59.9021673578135, 29.817553 59.90205"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":34.28,"TIME_STAGE":0.6166,"TIME_STAGE_PLAN":0.7,"DISTANCE_BACK":0.26,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 11:18:16","STOP_NAME":"УЛ. АННЫ ПАВЛОВОЙ","LATITUDE":59.9020586,"LONGITUDE":29.8175526,"STOP_NUMBER":7,"ID_STOP":22298,"STAGE_SHAPE":"29.817553 59.902057, 29.8178177520702 59.9021673578135, 29.8180862 59.9020054, 29.8184116 59.9018493, 29.8184116 59.9018493, 29.8187531350914 59.9017533136567, 29.8187603 59.9017513, 29.8187603 59.9017513, 29.8192652 59.9016249, 29.8201871 59.9013629, 29.8206877 59.9012366, 29.8206877 59.9012366, 29.8210371259814 59.9011314315018, 29.82082 59.9009"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":58.37,"TIME_STAGE":0.85,"TIME_STAGE_PLAN":0.6166,"DISTANCE_BACK":0.54,"DISTANCE_BACK_NORM":0.6,"STOP_TIME_PLAN":"01.09.2019 11:18:53","STOP_NAME":"МОРДВИНОВКА","LATITUDE":59.90095224,"LONGITUDE":29.8208218,"STOP_NUMBER":8,"ID_STOP":2884,"STAGE_SHAPE":"29.82082 59.90095, 29.8210371259814 59.9011314315018, 29.8211389 59.9011008, 29.8229235 59.9006274, 29.8238282 59.9003416, 29.8238282 59.9003416, 29.8249111 59.9000128, 29.827368968406 59.8993658328634, 29.8281137 59.8991698, 29.8281137 59.8991698, 29.8288444609756 59.8989436952773, 29.82868 59.8988"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":28.23,"TIME_STAGE":null,"TIME_STAGE_PLAN":0.85,"DISTANCE_BACK":0.32,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 11:19:44","STOP_NAME":"ЦВЕТОВОДЧЕСКИЙ ПИТОМНИК [200]<","LATITUDE":59.89881477,"LONGITUDE":29.82868,"STOP_NUMBER":9,"ID_STOP":3623,"STAGE_SHAPE":"29.82868 59.89881, 29.8288444609756 59.8989436952773, 29.8290361 59.8988844, 29.829901 59.8986602, 29.8307054 59.8985222, 29.8321407465691 59.8983064305713, 29.8337430456676 59.8980655622367, 29.8336766111111 59.897954397222"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":35.99,"TIME_STAGE":null,"TIME_STAGE_PLAN":1,"DISTANCE_BACK":0.75,"DISTANCE_BACK_NORM":0.6,"STOP_TIME_PLAN":"01.09.2019 11:20:44","STOP_NAME":"БИОЛОГИЧЕСКИЙ ИНСТИТУТ","LATITUDE":59.89795838,"LONGITUDE":29.8336754,"STOP_NUMBER":10,"ID_STOP":2582,"STAGE_SHAPE":"29.8336766111111 59.8979543972222, 29.8337430456676 59.8980655622367, 29.835022 59.8978733, 29.8350986 59.897861, 29.8350986 59.897861, 29.8354465 59.897804, 29.8354465 59.897804, 29.8359063 59.8977252, 29.836193 59.8976836, 29.8365332 59.8976608, 29.8370257 59.8976988, 29.8374587 59.8977431, 29.8378222 59.8977751, 29.8378629036277 59.897775632928, 29.838227 59.8977804, 29.8386263 59.8977332, 29.8389902 59.8976592, 29.8397022 59.8974919, 29.8404133 59.8972912, 29.8408599 59.8971401, 29.8412308 59.8969578, 29.8417933 59.8965881, 29.8420689 59.8963993, 29.8422248 59.8963106, 29.8424058 59.8962176, 29.8426069 59.8961581, 29.8428084 59.8961133, 29.843437 59.8959908, 29.843437 59.8959908, 29.8451390789457 59.8956726792893, 29.8450519027778 59.895555336111"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":33,"TIME_STAGE":null,"TIME_STAGE_PLAN":2,"DISTANCE_BACK":1.07,"DISTANCE_BACK_NORM":1.1,"STOP_TIME_PLAN":"01.09.2019 11:22:44","STOP_NAME":"ПОС. ПРОСВЕЩЕНИЯ","LATITUDE":59.89555693,"LONGITUDE":29.8450508,"STOP_NUMBER":11,"ID_STOP":2998,"STAGE_SHAPE":"29.8450519027778 59.8955553361111, 29.8451436909025 59.8956751192148, 29.845592218648 59.895588651265, 29.8456511 59.8955773, 29.852133 59.8943275, 29.852827 59.8942965, 29.852827 59.8942965, 29.8577974 59.8943799, 29.8580438 59.8943685, 29.8592016 59.8943147, 29.8592016 59.8943147, 29.8609091 59.8942354, 29.8613028 59.8942171, 29.8625256 59.8941213, 29.863005 59.8940314, 29.8631569103689 59.8940075263905, 29.863086 59.89389"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":-61.71,"TIME_STAGE":null,"TIME_STAGE_PLAN":-0.5833,"DISTANCE_BACK":0.69,"DISTANCE_BACK_NORM":0.6,"STOP_TIME_PLAN":"01.09.2019 11:22:09","STOP_NAME":"ОРАНИЕНБАУМСКИЙ СПУСК НА ОРАНИЕНБАУМ.Ш. []","LATITUDE":59.89389876,"LONGITUDE":29.8630867,"STOP_NUMBER":12,"ID_STOP":3956,"STAGE_SHAPE":"29.863086 59.893894, 29.8631516632039 59.8940049523592, 29.8636188 59.8939349, 29.8636188 59.8939349, 29.866464 59.8934192, 29.8699126913968 59.8928454635736, 29.8711283116305 59.8926603186143, 29.8724834067446 59.8924967, 29.8730283591887 59.8923868124269, 29.8745013560288 59.8920024475766, 29.8744444444445 59.891944444444"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":21,"TIME_STAGE":null,"TIME_STAGE_PLAN":2,"DISTANCE_BACK":0.52,"DISTANCE_BACK_NORM":0.7,"STOP_TIME_PLAN":"01.09.2019 11:24:09","STOP_NAME":"СОБСТВЕННЫЙ ПР.","LATITUDE":59.89194586,"LONGITUDE":29.874445,"STOP_NUMBER":13,"ID_STOP":22184,"STAGE_SHAPE":"29.8744444444445 59.8919444444444, 29.8745013560288 59.8920024475766, 29.8752737006899 59.8918010978593, 29.8772674 59.8913042, 29.8776239 59.8911664, 29.8777881441847 59.8910306702801, 29.8778517 59.8909114, 29.877874328837 59.8907989608903, 29.8778862288369 59.8906407732156, 29.8774194779076 59.8897741911418, 29.8772110370952 59.8893682947943, 29.8770562404675 59.8890646592149, 29.8778562153478 59.8886758298524, 29.877751 59.88862"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":45,"TIME_STAGE":2.5833,"TIME_STAGE_PLAN":1.2,"DISTANCE_BACK":0.98,"DISTANCE_BACK_NORM":0.9,"STOP_TIME_PLAN":"01.09.2019 11:25:21","STOP_NAME":"ФАБРИЧНАЯ УЛ. [200, 210, 351, 356, 356Б, 359]<","LATITUDE":59.88862567,"LONGITUDE":29.8777504,"STOP_NUMBER":14,"ID_STOP":3616,"STAGE_SHAPE":"29.877751 59.888622, 29.8778644538045 59.8886759114419, 29.8784052 59.8883895, 29.8800401 59.8875234, 29.881317 59.8868838999999, 29.8832532 59.8859082, 29.883348 59.8858609, 29.8850896 59.8849608, 29.8855259 59.8847586, 29.8855259 59.8847586, 29.8855511 59.8847469, 29.8859448 59.8845601, 29.887918 59.883606, 29.8884991 59.8833123, 29.8887505 59.8832028, 29.8887505 59.8832028, 29.8889682006808 59.8831160683379, 29.8892628 59.8829987, 29.8896013 59.8829036, 29.8896013 59.8829036, 29.8896802 59.8828648, 29.8898194 59.8828369, 29.8900928 59.8827886, 29.8902095 59.8827714, 29.8902470216469 59.8827658771756, 29.8901871138889 59.882663402777"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":15.15,"TIME_STAGE":1,"TIME_STAGE_PLAN":1.5833,"DISTANCE_BACK":0.35,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 11:26:56","STOP_NAME":"МАСТЕРОВОЙ ПЕР. [200, 210, 351, 356, 356Б, 359]<","LATITUDE":59.8826663,"LONGITUDE":29.8901882,"STOP_NUMBER":15,"ID_STOP":2880,"STAGE_SHAPE":"29.8901871138889 59.8826634027778, 29.8902470216469 59.8827658771756, 29.8910798 59.8826433, 29.8915999330124 59.8825654654546, 29.8920902 59.8824921, 29.8936007 59.8822675, 29.8950073 59.8820625, 29.8950521 59.8820556, 29.8953078 59.8820161, 29.8953078 59.8820161, 29.8955365 59.8819807, 29.8957493 59.8819478, 29.8958238 59.8819363, 29.8958372620084 59.8819343907373, 29.8957907138889 59.881851752777"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":29.99,"TIME_STAGE":1.3666,"TIME_STAGE_PLAN":1,"DISTANCE_BACK":0.5,"DISTANCE_BACK_NORM":0.5,"STOP_TIME_PLAN":"01.09.2019 11:27:56","STOP_NAME":"РАЗВОДНАЯ УЛ. [200, 210, 351, 356, 356Б, 359]<","LATITUDE":59.88185404,"LONGITUDE":29.8957939,"STOP_NUMBER":16,"ID_STOP":3156,"STAGE_SHAPE":"29.8957907138889 59.8818517527778, 29.8958372620084 59.8819343907373, 29.8969065894391 59.8817827319624, 29.8973623 59.8817181, 29.8987706 59.8815132, 29.9004392 59.8812727, 29.9023914 59.8809694, 29.9032894 59.8808358, 29.9034684 59.8808092, 29.9034684 59.8808092, 29.9037063 59.8807738, 29.9040472 59.8807231, 29.9041764931339 59.880703873131, 29.9041384027778 59.88063937"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":13.17,"TIME_STAGE":1.95,"TIME_STAGE_PLAN":1.3666,"DISTANCE_BACK":0.39,"DISTANCE_BACK_NORM":0.3,"STOP_TIME_PLAN":"01.09.2019 11:29:18","STOP_NAME":"ПРАВЛЕНСКАЯ УЛ. [200, 210, 351, 355, 356, 356Б, 359]<","LATITUDE":59.88064419,"LONGITUDE":29.9041386,"STOP_NUMBER":17,"ID_STOP":3136,"STAGE_SHAPE":"29.9041384027778 59.880639375, 29.9041764931339 59.880703873131, 29.9049604 59.8805873, 29.9051826995431 59.8805558232833, 29.9062747 59.8804012, 29.9062747 59.8804012, 29.9068276 59.880323, 29.9079563 59.8801632, 29.9091556 59.8799924, 29.9092822 59.8799744, 29.9092822 59.8799744, 29.9093916 59.8799588, 29.9105025603422 59.8798006056204, 29.9104391027778 59.879688383333"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":12.3,"TIME_STAGE":1.1833,"TIME_STAGE_PLAN":1.95,"DISTANCE_BACK":0.43,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 11:31:15","STOP_NAME":"КОНСТАНТИНОВСКАЯ УЛ., НИКОЛАЕВСКАЯ БОЛЬНИЦА","LATITUDE":59.87969135,"LONGITUDE":29.9104366,"STOP_NUMBER":18,"ID_STOP":2588,"STAGE_SHAPE":"29.9104391027778 59.8796883833333, 29.9105025603422 59.8798006056204, 29.9106571 59.8797786, 29.9110525 59.8797222, 29.9112028022359 59.8796992066475, 29.9118794 59.8795957, 29.9118794 59.8795957, 29.9132863 59.8793805, 29.9136431 59.8793259, 29.914291 59.8792267, 29.9146554 59.8791757, 29.9146554 59.8791757, 29.9148483 59.8791486, 29.917221 59.8788162, 29.9172282 59.8788152, 29.917455101768 59.8787844129612, 29.9174163277778 59.878712447222"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":20.28,"TIME_STAGE":1.85,"TIME_STAGE_PLAN":1.1833,"DISTANCE_BACK":0.4,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 11:32:26","STOP_NAME":"УЛ. АВРОВА","LATITUDE":59.8787145,"LONGITUDE":29.9174175,"STOP_NUMBER":19,"ID_STOP":20844,"STAGE_SHAPE":"29.9174163277778 59.8787124472222, 29.917455101768 59.8787844129612, 29.9187226720032 59.8786124228818, 29.9192977 59.8785344, 29.9193897 59.8785213, 29.9193897 59.8785213, 29.9194638 59.8785119, 29.920224 59.8784078, 29.9231247 59.8779813, 29.9231247 59.8779813, 29.9238003 59.8778835, 29.9241160601802 59.8778405900412, 29.924092 59.87779"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":6.48,"TIME_STAGE":null,"TIME_STAGE_PLAN":1.85,"DISTANCE_BACK":0.24,"DISTANCE_BACK_NORM":0.2,"STOP_TIME_PLAN":"01.09.2019 11:34:17","STOP_NAME":"МУЗЕЙ \"ДВОРЦОВАЯ ТЕЛЕГРАФНАЯ СТАНЦИЯ\"","LATITUDE":59.87779931,"LONGITUDE":29.9240932,"STOP_NUMBER":20,"ID_STOP":3642,"STAGE_SHAPE":"29.924092 59.877796, 29.9241160601802 59.8778405900412, 29.924701 59.8777611, 29.9253679783191 59.8776669535409, 29.9259507 59.8775847, 29.9259507 59.8775847, 29.9273305 59.8773972, 29.9280146589804 59.8772930006708, 29.927963375 59.877208194444"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":36,"TIME_STAGE":null,"TIME_STAGE_PLAN":2,"DISTANCE_BACK":1.11,"DISTANCE_BACK_NORM":1.2,"STOP_TIME_PLAN":"01.09.2019 11:36:17","STOP_NAME":"АЛЕКСАНДРИЯ [200, 210, 359]<","LATITUDE":59.87720974,"LONGITUDE":29.9279633,"STOP_NUMBER":21,"ID_STOP":2556,"STAGE_SHAPE":"29.927963375 59.8772081944444, 29.9280146589804 59.8772930006708, 29.928123 59.8772765, 29.9283268 59.8772487, 29.9284367 59.8772335, 29.9289541652863 59.8771577922992, 29.9310176 59.8768559, 29.9340929 59.8764058, 29.9357658 59.8761744, 29.9374843 59.8759146, 29.9407651 59.8754485, 29.943086 59.8751077, 29.9444866 59.8749011, 29.9456721 59.8747263, 29.94581 59.8747036, 29.94581 59.8747036, 29.9466792 59.87458, 29.9467303733268 59.8745724621421, 29.9466769888888 59.874481169444"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":98.18,"TIME_STAGE":null,"TIME_STAGE_PLAN":0.1833,"DISTANCE_BACK":0.31,"DISTANCE_BACK_NORM":0.3,"STOP_TIME_PLAN":"01.09.2019 11:36:28","STOP_NAME":"ЗНАМЕНКА,МОСТОВАЯ УЛ. [200, 210, 359]<","LATITUDE":59.87448456,"LONGITUDE":29.9466782,"STOP_NUMBER":22,"ID_STOP":2755,"STAGE_SHAPE":"29.9466769888888 59.8744811694444, 29.9467303733268 59.8745724621421, 29.9479984435447 59.874385674189, 29.9482094 59.8743546, 29.9482094 59.8743546, 29.949882 59.8741241, 29.9513715 59.8738947, 29.9517525391382 59.873839038896, 29.9516968111111 59.873742936111"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":23.99,"TIME_STAGE":null,"TIME_STAGE_PLAN":1,"DISTANCE_BACK":0.48,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 11:37:28","STOP_NAME":"РОПШИНСКОЕ ШОССЕ [200, 210, 359]<","LATITUDE":59.8737441,"LONGITUDE":29.9516983,"STOP_NUMBER":23,"ID_STOP":3169,"STAGE_SHAPE":"29.9516968111111 59.8737429361111, 29.9517525391382 59.873839038896, 29.9518329 59.8738273, 29.9520651552356 59.8737930357281, 29.9543524 59.8734556, 29.9557572 59.8732486, 29.9571611 59.8730456, 29.9571611 59.8730456, 29.9575946 59.8729793, 29.9575946 59.8729793, 29.9581456 59.8728967, 29.9590366 59.8727635, 29.9595015 59.8727032, 29.9595672636154 59.8726933916121, 29.9595085055555 59.872594141666"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":29.64,"TIME_STAGE":null,"TIME_STAGE_PLAN":1.4166,"DISTANCE_BACK":0.64,"DISTANCE_BACK_NORM":0.7,"STOP_TIME_PLAN":"01.09.2019 11:38:53","STOP_NAME":"МОРСКОЙ ПЕР.","LATITUDE":59.87259908,"LONGITUDE":29.9595089,"STOP_NUMBER":24,"ID_STOP":2754,"STAGE_SHAPE":"29.9595085055555 59.8725941416667, 29.9595672636154 59.8726933916121, 29.9605492896537 59.8725469258966, 29.9619045 59.8723448, 29.9619045 59.8723448, 29.9640506 59.8720397, 29.9664958 59.8716852, 29.9674426 59.8715499, 29.9683251 59.8713879, 29.9685228 59.871329, 29.9687917 59.8712432, 29.9692857 59.8710299, 29.9695791 59.8709068, 29.9697556 59.8708339, 29.9698497369601 59.8707929751437, 29.9697378027778 59.870728102777"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":35.99,"TIME_STAGE":null,"TIME_STAGE_PLAN":1,"DISTANCE_BACK":0.57,"DISTANCE_BACK_NORM":0.6,"STOP_TIME_PLAN":"01.09.2019 11:39:53","STOP_NAME":"ШУВАЛОВКА,УЛ. МАКАРОВА [210, 359, 200]<","LATITUDE":59.87073064,"LONGITUDE":29.9697399,"STOP_NUMBER":25,"ID_STOP":3662,"STAGE_SHAPE":"29.9697378027778 59.8707281027778, 29.9698497369601 59.8707929751437, 29.9705149922981 59.8705037623394, 29.9729899 59.8694278, 29.9734676 59.869226, 29.9739129 59.8690334, 29.9741065 59.8689415, 29.9741065 59.8689415, 29.976826 59.8677711, 29.976826 59.8677711, 29.976975 59.8677082, 29.9772291 59.8675883, 29.9773344842546 59.8675385423285, 29.9772369 59.867486458333"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":45.95,"TIME_STAGE":null,"TIME_STAGE_PLAN":0.7833,"DISTANCE_BACK":0.55,"DISTANCE_BACK_NORM":0.6,"STOP_TIME_PLAN":"01.09.2019 11:40:40","STOP_NAME":"САНКТ-ПЕТЕРБУРГСКОЕ ШОССЕ, 26КМ","LATITUDE":59.86749061,"LONGITUDE":29.9772358,"STOP_NUMBER":26,"ID_STOP":3234,"STAGE_SHAPE":"29.9772369 59.8674864583333, 29.9773344842546 59.8675385423285, 29.9776044 59.8674111, 29.9814705 59.8657559, 29.9840172 59.8646393, 29.9845459 59.8644075, 29.984613346839 59.8643779265144, 29.9845458138889 59.864339105555"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":35.99,"TIME_STAGE":null,"TIME_STAGE_PLAN":1,"DISTANCE_BACK":0.62,"DISTANCE_BACK_NORM":0.6,"STOP_TIME_PLAN":"01.09.2019 11:41:40","STOP_NAME":"ГОФМЕЙСТЕРСКАЯ УЛ.","LATITUDE":59.86434286,"LONGITUDE":29.9845448,"STOP_NUMBER":27,"ID_STOP":2711,"STAGE_SHAPE":"29.9845458138889 59.8643391055556, 29.984613346839 59.8643779265144, 29.9851692 59.8641342, 29.989822 59.8621512, 29.9918716 59.8612439, 29.9918716 59.8612439, 29.9924538 59.8609862, 29.9927787331016 59.8608423641005, 29.9926411805555 59.86076402"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":38.29,"TIME_STAGE":1.9,"TIME_STAGE_PLAN":1.5666,"DISTANCE_BACK":0.97,"DISTANCE_BACK_NORM":1,"STOP_TIME_PLAN":"01.09.2019 11:43:14","STOP_NAME":"УЛ. КРЫЛОВА [200, 210, 359]<","LATITUDE":59.86076612,"LONGITUDE":29.9926414,"STOP_NUMBER":28,"ID_STOP":3440,"STAGE_SHAPE":"29.9926411805555 59.860764025, 29.9927787331016 59.8608423641005, 29.9933182689498 59.8606035301068, 29.9939224 59.8603361, 29.9943743 59.8601596, 29.9959307 59.8598151, 29.9984077 59.8593276, 30.0046011 59.8580691, 30.0057634 59.8578329, 30.0057634 59.8578329, 30.0072601 59.8575287, 30.0072601 59.8575287, 30.0077989000001 59.8574192, 30.0080847839137 59.857361122744, 30.0080156527778 59.857275313888"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":13.33,"TIME_STAGE":0.4999,"TIME_STAGE_PLAN":0.9,"DISTANCE_BACK":0.26,"DISTANCE_BACK_NORM":0.2,"STOP_TIME_PLAN":"01.09.2019 11:44:08","STOP_NAME":"НАГОРНАЯ УЛ. [200, 210, 359]<","LATITUDE":59.85727818,"LONGITUDE":30.0080166,"STOP_NUMBER":29,"ID_STOP":2907,"STAGE_SHAPE":"30.0080156527778 59.8572753138889, 30.0080847839137 59.857361122744, 30.0083005 59.8573173, 30.0086849530525 59.8572385868813, 30.0116701 59.8566274, 30.0119643 59.8565672, 30.0121204742648 59.8565352293584, 30.0120511638889 59.8564498"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":200,"SPEED_NORM":28.31,"TIME_STAGE":null,"TIME_STAGE_PLAN":1.4833,"DISTANCE_BACK":0.7,"DISTANCE_BACK_NORM":0.7,"STOP_TIME_PLAN":"01.09.2019 11:49:07","STOP_NAME":"ОРЛОВСКИЙ ПРУД [200, 210, 359]<","LATITUDE":59.85248295,"LONGITUDE":30.0379677,"STOP_NUMBER":33,"ID_STOP":2949,"STAGE_SHAPE":"30.0379677222223 59.8524791555555, 30.0380259439966 59.8525898952322, 30.0384957 59.8525276, 30.0384957 59.8525276, 30.0386997 59.8525005, 30.0389447870608 59.8524697145154, 30.0393549 59.8524182, 30.0397562 59.8523805999999, 30.0403883 59.8523324, 30.0410303 59.8523058, 30.0416097 59.8522931, 30.0422173 59.8522691, 30.0425965 59.8522501, 30.0427938 59.8522295, 30.0429828 59.852193, 30.0431525 59.8521549, 30.0432909 59.8521086, 30.0434551 59.8520358, 30.043591 59.851964, 30.0440123 59.8517191, 30.0443673 59.8515284, 30.0445397 59.8514602, 30.0447182 59.8514016, 30.0449278 59.8513479, 30.0451995 59.8512954, 30.0453908 59.8512759, 30.0456054 59.8512624, 30.045801 59.8512624, 30.0460908 59.8512677, 30.0483816 59.8513021, 30.0483816 59.8513021, 30.0484875 59.8513037, 30.0490913 59.8513139, 30.0492841477278 59.8513170052442, 30.0492911888889 59.851206"}]};
    var json2 = {"tracks": [{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":26.24,"TIME_STAGE":2.0666,"TIME_STAGE_PLAN":1.6,"DISTANCE_BACK":0.63,"DISTANCE_BACK_NORM":0.7,"STOP_TIME_PLAN":"01.09.2019 08:13:54","STOP_NAME":"УЛ. ГОГОЛЯ [200, 210, 359]","LATITUDE":59.85290831,"LONGITUDE":30.0358906,"STOP_NUMBER":10,"ID_STOP":2202,"STAGE_SHAPE":"30.0358898027778 59.8529065305555, 30.03590167172 59.8528910879006, 30.0310688981413 59.8534328112932, 30.0287267 59.8536940465797, 30.0257866355816 59.8540285582597, 30.0249191765637 59.8541255694562, 30.0249333361111 59.854142538888"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":16.87,"TIME_STAGE":0.7666,"TIME_STAGE_PLAN":1.0666,"DISTANCE_BACK":0.23,"DISTANCE_BACK_NORM":0.3,"STOP_TIME_PLAN":"01.09.2019 08:14:58","STOP_NAME":"КРОПОТКИНСКАЯ УЛ.","LATITUDE":59.85414661,"LONGITUDE":30.0249348,"STOP_NUMBER":11,"ID_STOP":22296,"STAGE_SHAPE":"30.0249333361111 59.8541425388889, 30.0249245409822 59.8541255694562, 30.0227027865109 59.8543893700384, 30.0222305644185 59.8544769640042, 30.021341 59.8546563579039, 30.0211202515298 59.8547094040656, 30.021125 59.85472"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":20.37,"TIME_STAGE":1.2333,"TIME_STAGE_PLAN":1.7666,"DISTANCE_BACK":0.67,"DISTANCE_BACK_NORM":0.6,"STOP_TIME_PLAN":"01.09.2019 08:16:44","STOP_NAME":"НАГОРНАЯ УЛ. [200, 210, 359]","LATITUDE":59.85472973,"LONGITUDE":30.0211239,"STOP_NUMBER":12,"ID_STOP":1711,"STAGE_SHAPE":"30.021125 59.854727, 30.0211202515298 59.8547067100842, 30.019029028837 59.8551449213159, 30.016678 59.8556480512487, 30.0115644 59.8566912567506, 30.010325466428 59.8569545643872, 30.0104 59.8570"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":77.14,"TIME_STAGE":0.9,"TIME_STAGE_PLAN":0.2333,"DISTANCE_BACK":0.33,"DISTANCE_BACK_NORM":0.3,"STOP_TIME_PLAN":"01.09.2019 08:16:58","STOP_NAME":"УЛ. КРЫЛОВА [200, 210, 359]","LATITUDE":59.85703466,"LONGITUDE":30.0104008,"STOP_NUMBER":13,"ID_STOP":2260,"STAGE_SHAPE":"30.0104 59.85703, 30.0103308308465 59.8569599519856, 30.0072692913968 59.8575833187494, 30.0057593337229 59.857888656072, 30.00512511253 59.8580243386655, 30.00516 59.8580"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":28.42,"TIME_STAGE":null,"TIME_STAGE_PLAN":1.9,"DISTANCE_BACK":0.92,"DISTANCE_BACK_NORM":0.9,"STOP_TIME_PLAN":"01.09.2019 08:18:52","STOP_NAME":"ГОФМЕЙСТЕРСКАЯ УЛ.","LATITUDE":59.85807389,"LONGITUDE":30.0051613,"STOP_NUMBER":14,"ID_STOP":1502,"STAGE_SHAPE":"30.00516 59.85807, 30.00512511253 59.8580216449526, 30.0023437918465 59.858605502077, 29.9995785644185 59.8591866553364, 29.9971999389539 59.8596880974719, 29.9954366334448 59.8600465578433, 29.9949393306956 59.8601437418799, 29.9941666441848 59.8603695093425, 29.991956728837 59.8613348754901, 29.9909272239973 59.8617938841611, 29.991 59.8618"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":18,"TIME_STAGE":null,"TIME_STAGE_PLAN":2,"DISTANCE_BACK":0.55,"DISTANCE_BACK_NORM":0.6,"STOP_TIME_PLAN":"01.09.2019 08:20:52","STOP_NAME":"САНКТ-ПЕТЕРБУРГСКОЕ ШОССЕ, 26КМ","LATITUDE":59.86185325,"LONGITUDE":29.9909992,"STOP_NUMBER":15,"ID_STOP":1995,"STAGE_SHAPE":"29.991 59.86185, 29.9909272239973 59.8617965775686, 29.9874935576739 59.8632782926266, 29.9856020720924 59.8641051313053, 29.983689128837 59.8649211768143, 29.9837144761949 59.8649149781726, 29.98379 59.8649"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":-45.95,"TIME_STAGE":null,"TIME_STAGE_PLAN":-0.7833,"DISTANCE_BACK":0.57,"DISTANCE_BACK_NORM":0.6,"STOP_TIME_PLAN":"01.09.2019 08:20:05","STOP_NAME":"ШУВАЛОВКА,УЛ. МАКАРОВА [210, 359, 200]","LATITUDE":59.86496352,"LONGITUDE":29.9837894,"STOP_NUMBER":16,"ID_STOP":2482,"STAGE_SHAPE":"29.98379 59.86496, 29.9837144761949 59.8649042055513, 29.9820273813529 59.8656580638333, 29.9803349220924 59.8663742025356, 29.9769892086032 59.8677872433855, 29.9761679958946 59.8681568307499, 29.97631 59.8682"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":23.99,"TIME_STAGE":null,"TIME_STAGE_PLAN":1,"DISTANCE_BACK":0.55,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 08:21:05","STOP_NAME":"МОРСКОЙ ПЕР.","LATITUDE":59.86821408,"LONGITUDE":29.9763107,"STOP_NUMBER":17,"ID_STOP":1549,"STAGE_SHAPE":"29.97631 59.86821, 29.976173360313 59.8681568307499, 29.9741427 59.8690192354118, 29.973195428837 59.8694412062674, 29.971620897557 59.8701166636543, 29.9707799877324 59.8704772751987, 29.9698747048859 59.8708567315541, 29.969058403907 59.8712173203664, 29.969255 59.87131"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":21,"TIME_STAGE":null,"TIME_STAGE_PLAN":2,"DISTANCE_BACK":0.61,"DISTANCE_BACK_NORM":0.7,"STOP_TIME_PLAN":"01.09.2019 08:23:05","STOP_NAME":"РОПШИНСКОЕ ШОССЕ [200, 210, 359]","LATITUDE":59.87132033,"LONGITUDE":29.9692554,"STOP_NUMBER":18,"ID_STOP":1976,"STAGE_SHAPE":"29.969255 59.871316, 29.9690637683255 59.8712227056551, 29.9687651746303 59.8713375577553, 29.968466580935 59.8714281758204, 29.9680925374402 59.871502074597, 29.9675605425021 59.8715996188715, 29.9672538531399 59.871648695922, 29.9665600081386 59.8717522350086, 29.9650435720923 59.8719754677174, 29.9619355981413 59.872405773353, 29.9596948134891 59.8727492280293, 29.9591497713903 59.8728253637414, 29.959191 59.87291"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":-25.26,"TIME_STAGE":0.85,"TIME_STAGE_PLAN":-0.9499,"DISTANCE_BACK":0.4,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 08:22:08","STOP_NAME":"ЗНАМЕНКА,МОСТОВАЯ УЛ. [200, 210, 359]","LATITUDE":59.87291791,"LONGITUDE":29.9591904,"STOP_NUMBER":19,"ID_STOP":1550,"STAGE_SHAPE":"29.959191 59.872916, 29.9591497713903 59.872822671227, 29.9559434810486 59.8732814216546, 29.9530912423262 59.873707856454, 29.9527175880763 59.8737621416749, 29.952781 59.8738"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":35.29,"TIME_STAGE":0.6666,"TIME_STAGE_PLAN":0.85,"DISTANCE_BACK":0.53,"DISTANCE_BACK_NORM":0.5,"STOP_TIME_PLAN":"01.09.2019 08:22:59","STOP_NAME":"АЛЕКСАНДРИЯ [200, 210, 359]","LATITUDE":59.8738915,"LONGITUDE":29.9527798,"STOP_NUMBER":20,"ID_STOP":1344,"STAGE_SHAPE":"29.952781 59.87389, 29.9527175880763 59.8737648341132, 29.9504502779077 59.8740999482662, 29.9482712355816 59.8744128629794, 29.9457956779076 59.8747694777384, 29.943945128254 59.8750389634632, 29.94396 59.875"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":32.39,"TIME_STAGE":null,"TIME_STAGE_PLAN":1.6666,"DISTANCE_BACK":0.9,"DISTANCE_BACK_NORM":0.9,"STOP_TIME_PLAN":"01.09.2019 08:24:39","STOP_NAME":"МУЗЕЙ \"ДВОРЦОВАЯ ТЕЛЕГРАФНАЯ СТАНЦИЯ\"","LATITUDE":59.8751016,"LONGITUDE":29.9439621,"STOP_NUMBER":21,"ID_STOP":2464,"STAGE_SHAPE":"29.94396 59.8751, 29.9439385964306 59.8750419007606, 29.9420027869992 59.8753279568484, 29.9401474438449 59.8755897798695, 29.9364006978816 59.876141681801, 29.9345139138539 59.8764095526597, 29.9325305702935 59.8767070355732, 29.9288574349141 59.877242772539, 29.928928 59.87736"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":29.99,"TIME_STAGE":null,"TIME_STAGE_PLAN":1,"DISTANCE_BACK":0.54,"DISTANCE_BACK_NORM":0.5,"STOP_TIME_PLAN":"01.09.2019 08:25:39","STOP_NAME":"КОНСТАНТИНОВСКАЯ УЛ., НИКОЛАЕВСКАЯ БОЛЬНИЦА","LATITUDE":59.87736399,"LONGITUDE":29.9289303,"STOP_NUMBER":22,"ID_STOP":1381,"STAGE_SHAPE":"29.928928 59.877361, 29.9288575684831 59.8772417432166, 29.9281323232611 59.8773472566976, 29.9259974 59.8776661031265, 29.9231781779077 59.8780592023306, 29.9205272644184 59.8784373253701, 29.9199524864598 59.8785223327295, 29.91998 59.8785"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":36,"TIME_STAGE":1.6333,"TIME_STAGE_PLAN":0.6666,"DISTANCE_BACK":0.33,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 08:26:19","STOP_NAME":"ТОРГОВАЯ П ОЩАДЬ [351, 356, 210, 200, 359]","LATITUDE":59.87858425,"LONGITUDE":29.9199829,"STOP_NUMBER":23,"ID_STOP":2139,"STAGE_SHAPE":"29.91998 59.87858, 29.9199471220412 59.8785223327295, 29.9194152932555 59.8786016171289, 29.9169188267489 59.8789499432525, 29.9144330890793 59.8792848057727, 29.91445 59.8793"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":11.02,"TIME_STAGE":2.05,"TIME_STAGE_PLAN":1.6333,"DISTANCE_BACK":0.39,"DISTANCE_BACK_NORM":0.3,"STOP_TIME_PLAN":"01.09.2019 08:27:57","STOP_NAME":"ПРАВЛЕНСКАЯ УЛ. [200, 210, 351, 355, 356, 356Б, 359]","LATITUDE":59.87935546,"LONGITUDE":29.9144497,"STOP_NUMBER":24,"ID_STOP":1938,"STAGE_SHAPE":"29.91445 59.87935, 29.9144277246608 59.8792874977638, 29.9133028067446 59.879476599461, 29.9119448220923 59.8796730151332, 29.9093029797663 59.8800547628227, 29.9079758416302 59.8802449760288, 29.908 59.8803"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":11.7,"TIME_STAGE":1.2,"TIME_STAGE_PLAN":2.05,"DISTANCE_BACK":0.32,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 08:30:00","STOP_NAME":"РАЗВОДНАЯ УЛ. [200, 210, 351, 356, 356Б, 359]","LATITUDE":59.88031515,"LONGITUDE":29.907999,"STOP_NUMBER":25,"ID_STOP":1962,"STAGE_SHAPE":"29.908 59.88031, 29.9079704772117 59.8802503598554, 29.9068212067446 59.8804183570815, 29.9062503490707 59.8805014244784, 29.904916626394 59.8806932854982, 29.9035024374402 59.8808905291334, 29.9027330240204 59.8809970679299, 29.90275 59.8810"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":20,"TIME_STAGE":1.75,"TIME_STAGE_PLAN":1.2,"DISTANCE_BACK":0.49,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 08:31:12","STOP_NAME":"МАСТЕРОВОЙ ПЕР. [200, 210, 351, 356, 356Б, 359]","LATITUDE":59.88108289,"LONGITUDE":29.90275,"STOP_NUMBER":26,"ID_STOP":1678,"STAGE_SHAPE":"29.90275 59.88108, 29.902727659602 59.8809997597824, 29.8997278220923 59.881442079126, 29.8974936067446 59.8817746300624, 29.8953130355815 59.882080260034, 29.8946168388884 59.88218155963, 29.894657 59.88226"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":13.71,"TIME_STAGE":1.3,"TIME_STAGE_PLAN":1.75,"DISTANCE_BACK":0.35,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 08:32:57","STOP_NAME":"ФАБРИЧНАЯ УЛ. [200, 210, 351, 356, 356Б, 359]","LATITUDE":59.88226531,"LONGITUDE":29.8946552,"STOP_NUMBER":27,"ID_STOP":2436,"STAGE_SHAPE":"29.894657 59.882261, 29.8946222033069 59.8821842513865, 29.8908468355815 59.8827417928501, 29.8900099862997 59.8828656113383, 29.8897664742045 59.8829131861669, 29.8896087928049 59.8829069270128, 29.8892558790764 59.8829993847933, 29.8889995988313 59.8830993829272, 29.8891038305556 59.883155033333"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":23.63,"TIME_STAGE":2.5166,"TIME_STAGE_PLAN":3.3,"DISTANCE_BACK":1.43,"DISTANCE_BACK_NORM":1.3,"STOP_TIME_PLAN":"01.09.2019 08:36:15","STOP_NAME":"ЖЕЛЕЗНОДОРОЖНЫЙ ПЕРЕЕЗД","LATITUDE":59.88315981,"LONGITUDE":29.8891029,"STOP_NUMBER":28,"ID_STOP":14690,"STAGE_SHAPE":"29.8891038305556 59.8831550333333, 29.8889942344129 59.8830966912447, 29.8885244113912 59.8833049756311, 29.8879687576739 59.8835778582205, 29.8855433576739 59.8847482648083, 29.8849868773075 59.8844585326, 29.8843660239193 59.8842145549614, 29.8834016901647 59.8838227715436, 29.8824105343177 59.8834296376796, 29.8814140140522 59.8830257324138, 29.8774708483382 59.8814746658608, 29.875260548859 59.880565857276, 29.8730663426354 59.8796597158033, 29.8725231157309 59.879421321917, 29.8718994225493 59.8791425463041, 29.87088144461 59.8786860942057, 29.8698366445782 59.8782269437627, 29.869723 59.878"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":27.69,"TIME_STAGE":1.5333,"TIME_STAGE_PLAN":1.5166,"DISTANCE_BACK":0.67,"DISTANCE_BACK_NORM":0.7,"STOP_TIME_PLAN":"01.09.2019 08:37:46","STOP_NAME":"Ж.Д. СТ. СТАРЫЙ ПЕТЕРГОФ [210, 356Б, 351, 356, 358, 359]","LATITUDE":59.87830318,"LONGITUDE":29.8697224,"STOP_NUMBER":29,"ID_STOP":1525,"STAGE_SHAPE":"29.869723 59.8783, 29.8698366445782 59.8782269437627, 29.8689180977537 59.8778134362379, 29.867962 59.8774133842861, 29.8663125558153 59.8766656830748, 29.8654985 59.8775589, 29.8647389355816 59.8784425158815, 29.8642622644185 59.878933715961, 29.8640741086032 59.8790414319579, 29.8637539220924 59.8791286320841, 29.8635965110462 59.8791587720569, 29.8634015490707 59.8791808360043, 29.8631105413968 59.8791587860259, 29.8628731779076 59.8791232760139, 29.8626225073365 59.8790256292065, 29.862422 59.8791"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":67.5,"TIME_STAGE":2.1833,"TIME_STAGE_PLAN":0.5333,"DISTANCE_BACK":0.66,"DISTANCE_BACK_NORM":0.6,"STOP_TIME_PLAN":"01.09.2019 08:38:18","STOP_NAME":"УНИВЕРСИТЕТСКИЙ ПР.","LATITUDE":59.87916351,"LONGITUDE":29.862421,"STOP_NUMBER":30,"ID_STOP":17143,"STAGE_SHAPE":"29.862422 59.87916, 29.8626225073365 59.8790256292065, 29.8625348730217 59.8789840798549, 29.8622580018586 59.8788117521813, 29.861976671163 59.878579876146, 29.8610445 59.8779156, 29.8598944 59.8771151, 29.8567516423261 59.874996546814, 29.8562330609731 59.8745964458181, 29.8559451496143 59.8744063468031, 29.855819 59.87445"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":8.24,"TIME_STAGE":1.4833,"TIME_STAGE_PLAN":2.1833,"DISTANCE_BACK":0.41,"DISTANCE_BACK_NORM":0.3,"STOP_TIME_PLAN":"01.09.2019 08:40:29","STOP_NAME":"ЧИЧЕРИНСКАЯ УЛ. УГ. БОТАНИЧЕСКОЙ УЛ.","LATITUDE":59.87445714,"LONGITUDE":29.8558197,"STOP_NUMBER":31,"ID_STOP":26509,"STAGE_SHAPE":"29.855819 59.874452, 29.8559570746237 59.8744016607214, 29.8554924 59.8740806, 29.8554924 59.8740806, 29.8552651 59.8739223, 29.8547263 59.8735502, 29.8543734 59.8733065, 29.8537064 59.8728502, 29.8532636 59.8725431, 29.8531404 59.8724495, 29.853026 59.8723704, 29.8523463 59.8719007, 29.8522176 59.8718117, 29.8522176 59.8718117, 29.8518033 59.8719031, 29.851633955312 59.8719404738683, 29.851708 59.87202"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":12.08,"TIME_STAGE":1.85,"TIME_STAGE_PLAN":2.4833,"DISTANCE_BACK":0.52,"DISTANCE_BACK_NORM":0.5,"STOP_TIME_PLAN":"01.09.2019 08:42:58","STOP_NAME":"УЛ. ДЗЕРЖИНСКОГО","LATITUDE":59.87202656,"LONGITUDE":29.8517075,"STOP_NUMBER":32,"ID_STOP":26741,"STAGE_SHAPE":"29.851708 59.872025, 29.851633955312 59.8719404738683, 29.8498744 59.8723288, 29.8498744 59.8723288, 29.8440039 59.8736555, 29.8440039 59.8736555, 29.843957 59.8736661, 29.8434866570564 59.8737729950996, 29.843585 59.87388"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":35.29,"TIME_STAGE":1.2666,"TIME_STAGE_PLAN":0.85,"DISTANCE_BACK":0.41,"DISTANCE_BACK_NORM":0.5,"STOP_TIME_PLAN":"01.09.2019 08:43:49","STOP_NAME":"БОТАНИЧЕСКАЯ УЛ. 17 [210, 356А-шк, 358, 359]","LATITUDE":59.87388465,"LONGITUDE":29.843586,"STOP_NUMBER":33,"ID_STOP":1397,"STAGE_SHAPE":"29.843585 59.873882, 29.8434866570564 59.8737729950996, 29.8415088 59.8742225, 29.8415088 59.8742225, 29.8395955 59.8746494, 29.8391236 59.8747547, 29.8386313 59.8748645, 29.837751 59.8750609, 29.837751 59.8750609, 29.8372042 59.8751829, 29.8371446149658 59.8751961968612, 29.83721 59.8752"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":18.94,"TIME_STAGE":1.0166,"TIME_STAGE_PLAN":1.2666,"DISTANCE_BACK":0.43,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 08:45:05","STOP_NAME":"РЕКТОРСКИЙ ПРОЕЗД [210, 356А-шк, 358, 359]","LATITUDE":59.875273,"LONGITUDE":29.8372097,"STOP_NUMBER":34,"ID_STOP":1972,"STAGE_SHAPE":"29.83721 59.87527, 29.8371496669905 59.8752002648528, 29.8362331588426 59.8753958846172, 29.8331674 59.876082, 29.8313218490707 59.876484723347, 29.8303257698179 59.876708318401, 29.83039 59.8767"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":23.6,"TIME_STAGE":1.5,"TIME_STAGE_PLAN":1.0166,"DISTANCE_BACK":0.44,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 08:46:06","STOP_NAME":"БОТАНИЧЕСКАЯ УЛ. УГ. УЛЬЯНОВСКОЙ УЛ. [358, 359, 356А-шк, 210]<","LATITUDE":59.8767847,"LONGITUDE":29.8303909,"STOP_NUMBER":35,"ID_STOP":2605,"STAGE_SHAPE":"29.83039 59.87678, 29.8303257698179 59.876708318401, 29.8297302846522 59.8768490843774, 29.8250572 59.8778815, 29.8247911 59.8779418, 29.8240924269783 59.8780923525308, 29.8244540924445 59.878467476391, 29.8245716361111 59.87844742"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":16,"TIME_STAGE":0.9833,"TIME_STAGE_PLAN":1.5,"DISTANCE_BACK":0.36,"DISTANCE_BACK_NORM":0.4,"STOP_TIME_PLAN":"01.09.2019 08:47:36","STOP_NAME":"ГОР. ПЕТРОДВОРЕЦ, УНИВЕРСИТЕТ","LATITUDE":59.87845057,"LONGITUDE":29.8245754,"STOP_NUMBER":36,"ID_STOP":3850,"STAGE_SHAPE":"29.8245716361111 59.878447425, 29.8244540924445 59.8784701684484, 29.8255589846522 59.8797612758589, 29.8257710490707 59.8799978516049, 29.8264133981414 59.8807354674968, 29.8267456693045 59.8811204836856, 29.8269444444445 59.881388888888"},{"DDATE":"01.09.2019 00:00:00","ROUTE_NUMBER":359,"SPEED_NORM":3.05,"TIME_STAGE":0.3333,"TIME_STAGE_PLAN":0.9833,"DISTANCE_BACK":0.08,"DISTANCE_BACK_NORM":0.05,"STOP_TIME_PLAN":"01.09.2019 08:48:35","STOP_NAME":"Г. ПЕТЕРГОФ, УНИВЕРСИТЕТ","LATITUDE":59.88139135,"LONGITUDE":29.8269444,"STOP_NUMBER":37,"ID_STOP":3853,"STAGE_SHAPE":"29.8269444444445 59.8813888888889, 29.826950999909 59.8813874223014, 29.8269393795235 59.8813743436438, 29.827213741381 59.8816452019981, 29.8271095234784 59.8816621914152, 29.8268535666252 59.8813907379471, 29.82678 59.8814"}]};
    //var json = JSON.parse($v('P3_JSON'));
    //var json = JSON.parse(json1);
    var tracks = [];
    tracks.push(json1.tracks);
    tracks.push(json2.tracks);
    var stage_speed_norm = [], stage_shape = [], stage_time_plan = [], stop = [];

    var bus_stops = [];
    //new Set();


    for (i = 0; i < tracks.length; i++) {
        stage_speed_norm.push([]);
        stage_shape.push([]);
        stage_time_plan.push([]);
        stop.push([]);
        for (j = 0; j < tracks[i].length; j++) {
            stage_speed_norm[i].push(tracks[i][j].SPEED_NORM);
            stage_shape[i].push(tracks[i][j].STAGE_SHAPE);
            stage_time_plan[i].push(tracks[i][j].TIME_STAGE_PLAN);
            stop[i].push([tracks[i][j].LONGITUDE, tracks[i][j].LATITUDE])
        }
    }

    var coordinates2 = get_shape(stringCoord2);

    function get_shape(stringCoord) {
        let arr = stringCoord.split(', ');

        let coordinates = [];

        for (let coordinate of arr) {

            let coord = coordinate.split(' ');

            coordinates.push(coord);
        }

        return coordinates;

    }

    var tracks_coord = [];
    var stage_coord = [];
    for (i = 0; i < stage_shape.length; i++) {
        var track_coord = []
        stage_coord.push([]);
        //track_coord.push(get_shape(stringCoord[i]));
        for (j = 0; j < stage_shape[i].length; j++) {
            //console.log(stage_shape[i][j])
            var shape = get_shape(stage_shape[i][j])
            stage_coord[i].push(shape);
            bus_stops.push(stop[i][j]);
                //.add(stop[i][j]);
            for (k = 0; k < shape.length; k++) {
                //console.log(shape[k]);
                track_coord.push(shape[k]);
            }
        }
        tracks_coord.push(track_coord);
    }
    //console.log(tracks_coord);

    var busroute_stage = {
        'type': 'FeatureCollection',
        'features': []
    };

    for (i = 0; i < tracks_coord.length; i++) {
        busroute_stage.features.push([]);
        for (j = 0; j < stage_coord[i].length; j++) {
            busroute_stage.features[i].push({
                'type': 'Feature',
                'geometry': {
                    "type": "LineString",
                    "coordinates": stage_coord[i][j]
                }
            });
        }
    }

    //console.log(busroute_stage.features[0][1]);

    var busroute = {
        'type': 'FeatureCollection',
        'features': []
    };

    for (i = 0; i < tracks_coord.length; i++) {
        busroute.features.push({
            'type': 'Feature',
            'geometry': {
                'type': 'LineString',
                'coordinates': tracks_coord[i]
            }
        });
    }

    var tramroute = {
        'type': 'FeatureCollection',
        'features': [{
            'type': 'Feature',
            'geometry': {
                'type': 'LineString',
                'coordinates': coordinates2
            }
        }]
    };


    // A single point that animates along the route.
    // Coordinates are initially set to origin.
    var busstop = {
        'type': 'FeatureCollection',
        'features': []
    };

    for (i = 0; i < bus_stops.length; i++) {
            busstop.features.push({
                'type': 'Feature',
                'geometry': {
                    "type": "Point",
                    "coordinates": bus_stops[i]
                }
            });
    }

    var buspoint = {
        'type': 'FeatureCollection',
        'features': []
    };

    for (i = 0; i < tracks_coord.length; i++) {
        buspoint.features.push({
            'type': 'Feature',
            'properties': {},
            'geometry': {
                'type': 'Point',
                'coordinates': origin
            }
        });
    }

    var trampoint = {
        'type': 'FeatureCollection',
        'features': [{
            'type': 'Feature',
            'properties': {},
            'geometry': {
                'type': 'Point',
                'coordinates': origin
            }
        }]
    };

    // Calculate the distance in kilometers between route start/end point.
    //можно взять как сумму дистанций между остановками
    var lineDistance2 = turf.lineDistance(tramroute.features[0], 'kilometers');


    var lineDistance = [];
    for (i = 0; i < busroute.features.length; i++) {
        lineDistance.push([]);
        for (j = 0; j < busroute_stage.features[i].length; j++) {
            lineDistance[i].push(turf.lineDistance(busroute_stage.features[i][j], 'kilometers'));
            //console.log(lineDistance);
        }
    }

    //console.log(lineDistance);

    var arc = [];
    for (i = 0; i < busroute.features.length; i++) {
        arc.push([]);
    }
    //var arc = [];
    var arc2 = [];
    //var arc3 = [];
    //var arc200 = [];

    // Number of steps to use in the arc and animation, more steps means
    // a smoother arc and animation, but too many steps will result in a
    // low frame rate
    var steps = [];

    var steps2 = 1000;
    for (j = 0; j < busroute.features.length; j++) {
        steps.push(1000);
    }

    // Draw an arc between the `origin` & `destination` of the two points
    /*
    for (j = 1; j < busroute.features.length; j++) {
            for (var i = 0; i < lineDistance[j]; i += lineDistance[j] / steps[j]) {
                 var segment = turf.along(busroute.features[j], i, 'kilometers');
              arc[j].push(segment.geometry.coordinates);
          arc200.push(segment.geometry.coordinates);
            }
    }
    */

    for (i = 0; i < busroute.features.length; i++) {
        for (j = 0; j < busroute_stage.features[i].length; j++) {
            for (k = 0; k < lineDistance[i][j]; k += Math.abs(stage_speed_norm[i][j]/3600)) {
                var segment = turf.along(busroute_stage.features[i][j], k, 'kilometers');
                //console.log(busroute_stage.features[i][j]);
                arc[i].push(segment.geometry.coordinates);
                //arc200.push(segment.geometry.coordinates);
            }
        }
    }


    for (var i = 0; i < lineDistance2; i += lineDistance2 / steps2) {
        var segment = turf.along(tramroute.features[0], i, 'kilometers');
        arc2.push(segment.geometry.coordinates);
    }



    // Update the route with calculated arc coordinates
    console.log(busroute.features.length);
    console.log(arc[0]);
    for (i = 0; i < busroute.features.length; i++) {
        busroute.features[i].geometry.coordinates = arc[i];
        //console.log(arc)
    }
    //busroute.features[0].geometry.coordinates = arc200;

    tramroute.features[0].geometry.coordinates = arc2;

    // Used to increment the value of the point measurement against the route.
    var counter = 0;
    //var count = 0;
    var tick_interval = 10;
    setInterval(tick, tick_interval);

    function tick() {
        counter++;
    }


    map.on('load', function() {
        // Add a source and layer displaying a point which will be animated in a circle.
        map.addSource('busroute', {
            'type': 'geojson',
            'data': busroute
        });

        map.addSource('tramroute', {
            'type': 'geojson',
            'data': tramroute
        });

        map.addSource('buspoint', {
            'type': 'geojson',
            'data': buspoint
        });

        map.addSource('trampoint', {
            'type': 'geojson',
            'data': trampoint
        });

        map.addSource('busstop', {
            'type': 'geojson',
            'data': busstop
        });

        map.addLayer({
            'id': 'busroute',
            'source': 'busroute',
            'type': 'line',
            'paint': {
                'line-width': 5,
                'line-color': '#3a8abf'
            }
        });

        map.addLayer({
            'id': 'tramroute',
            'source': 'tramroute',
            'type': 'line',
            'paint': {
                'line-width': 5,
                'line-color': '#bf0500'
            }
        });

        map.addLayer({
            'id': 'buspoint',
            'source': 'buspoint',
            'type': 'symbol',
            'layout': {
                'icon-image': 'bus',
                'icon-rotate': ['get', 'bearing'],
                'icon-rotation-alignment': 'map',
                'icon-allow-overlap': true,
                'icon-ignore-placement': true,
                'icon-size': 1.25
            }
        });

        map.addLayer({
            'id': 'trampoint',
            'source': 'trampoint',
            'type': 'symbol',
            'layout': {
                'icon-image': 'rail-light',
                'icon-rotate': ['get', 'bearing'],
                'icon-rotation-alignment': 'map',
                'icon-allow-overlap': true,
                'icon-ignore-placement': true
            }
        });

        map.addLayer({
            'id': 'busstop',
            'source': 'busstop',
            'type': 'symbol',
            'layout': {
                'icon-image': 'bus',
                'icon-allow-overlap': true,
                'icon-ignore-placement': true,
                'icon-size': 0.75
            }
        });

        function animate() {
            // Update point geometry to a new position based on counter denoting
            // the index to access the arc.
            for (i = 0; i < busroute.features.length; i++) {
                if (counter < busroute.features[i].geometry.coordinates.length) {
                buspoint.features[i].geometry.coordinates =
                    busroute.features[i].geometry.coordinates[counter];
                }
            }

            if (counter < tramroute.features[0].geometry.coordinates.length) {
                trampoint.features[0].geometry.coordinates =
                    tramroute.features[0].geometry.coordinates[counter];
            }
            // Calculate the bearing to ensure the icon is rotated to match the route arc
            // The bearing is calculate between the current point and the next point, except
            // at the end of the arc use the previous point and the current point
            for (i = 0; i < busroute.features.length; i++) {
                if (counter < busroute.features[i].geometry.coordinates.length) {
                buspoint.features[i].properties.bearing = turf.bearing(
                    turf.point(
                        busroute.features[i].geometry.coordinates[
                            counter >= steps[i] ? counter - 1 : counter
                            ]
                    ),
                    turf.point(
                        busroute.features[i].geometry.coordinates[
                            counter >= steps[i] ? counter : counter + 1
                            ]
                    )
                );
                }
            }

            if (counter < tramroute.features[0].geometry.coordinates.length) {
                trampoint.features[0].properties.bearing = turf.bearing(
                    turf.point(
                        tramroute.features[0].geometry.coordinates[
                            counter >= steps2 ? counter - 1 : counter
                            ]
                    ),
                    turf.point(
                        tramroute.features[0].geometry.coordinates[
                            counter >= steps2 ? counter : counter + 1
                            ]
                    )
                );
            }

            // Update the source with this new data.
            map.getSource('buspoint').setData(buspoint);
            map.getSource('trampoint').setData(trampoint);
            map.getSource('busstop').setData(busstop);

            // Request the next frame of animation so long the end has not been reached.
            //if (counter < steps[0]) {
            requestAnimationFrame(animate);
            //}


            //counter = counter + 1;
        }

        document.getElementById('replay').addEventListener('click', function() {
            // Set the coordinates of the original point back to origin
            buspoint.features[0].geometry.coordinates = origin;

            // Update the source layer
            map.getSource('buspoint').setData(buspoint);

            // Reset the counter
            counter = 0;

            // Restart the animation.
            animate(counter);
        });

        // Start the animation.
        animate(counter);
    });
</script>

</body>
</html>